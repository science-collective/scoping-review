---
title: "Review stages"
format: html
---

```{r setup}
#| include: false
library(tidyverse)
library(here)
library(fs)
```

<!-- TODO: Include last date the articles were extracted from. -->

## Title review stage

During the first stage of the reviewing, we only looked at titles. Below
is the code to extract the titles we each individually reviewed, so we
can show some details about how many were included, excluded, and which
titles we agreed on or disagreed on.

```{r}
#| message: false
title_reviews <- here("data/review/titles/") |>
  dir_ls(glob = "*.csv") |>
  map(read_csv)

reviewers <- names(title_reviews) |>
  path_file() |>
  path_ext_remove() |>
  str_to_sentence()

title_reviews <- title_reviews |>
  set_names(reviewers)
```

In the title screening stage, the number of titles we kept are listed in
@tbl-titles-kept.

```{r tbl-titles-kept}
#| message: false
#| tbl-cap: "Number of articles each reviewer kept after the first screening of the titles."
title_reviews |>
  map(\(df) count(df, name = "Articles kept")) |>
  list_rbind(names_to = "Reviewers") |>
  # TODO: Include percent of total articles.
  knitr::kable()
```

We want to know how many of these titles we all agreed on between the
three reviewers, which is shown in @tbl-titles-agreements

```{r}
common_titles <- title_reviews |>
  reduce(\(df1, df2) {
    inner_join(df1, df2, by = join_by(id, title, publication_date, doi))
  })

#| tbl-cap: "Number of articles we all agreed on."
common_titles |>
  count(name = "Titles all agreed on") |>
  knitr::kable()

```

```{r tbl-titles-agreements}
#| tbl-cap: !expr glue::glue("The {nrow(common_titles)} article titles we all agreed on and kept during the title screening stage.")
common_titles |>
  select("Article title" = title) |>
  knitr::kable()
```

One person will review the titles and flag any paper that might be
relevant but are not in agreement to keep.

```{r tbl-title-disagreements}
#| tbl-cap: "Article titles **not** kept between all reviewers during the title screening stage."
title_reviews |>
  map(\(df) anti_join(df, common_titles, by = join_by(id, title, publication_date, doi))) |>
  list_rbind() |>
  select("Article titles" = title) |>
  distinct() |>
  knitr::kable()
```

We saved a new csv file with all the disagreements and saved a new list
called "resolved.csv" where the final papers to include are listed.

```{r csv-paper-disagreements}

title_disagrements <- title_reviews |>
  map(\(df) anti_join(df, common_titles, by = join_by(id, title, publication_date, doi))) |>
  list_rbind() |>
  distinct()

#save new csv file to go through links and check disagreements
write.table(title_disagrements, file = here("data/review/titles/disagreements.csv"))

```

## Abstract review stage

-   all will review the abstracts of the included papers
-   this will create our final list of included papers

## Reading stage

-   first skimming the papers and group by themes
-   then read a few from each theme to decide on what information to
    extract
-   then discuss together the themes to group by and information to
    extract
-   then we follow what we agreed on

## Writing stage

-   how to visualize?
